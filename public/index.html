<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti칩n de Licencias Funerarias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem; /* Padding para evitar que toque los bordes */
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 2rem; /* Reducido considerablemente desde 15rem */
            width: 100%;
            max-width: 400px; /* Ancho m치ximo definido */
            text-align: center;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }

        h1 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 2rem;
            line-height: 1.2;
            word-wrap: break-word; /* Para palabras largas */
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-login {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 1rem;
        }

        .btn-login:hover {
            transform: translateY(-2px);
        }

        .btn-login:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: #dc3545;
            margin-top: 1rem;
            padding: 0.5rem;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            display: none;
            font-size: 0.9rem;
        }

        /* Media queries para diferentes tama침os de pantalla */
        @media (max-width: 768px) {
            .login-container {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .logo {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }
            
            .login-container {
                padding: 1rem;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
            }
            
            input[type="text"],
            input[type="password"] {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
            
            .btn-login {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }

        /* Resto de estilos para el dashboard cuando est칠 activo */
        .dashboard {
            display: none;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 100%;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e1e5e9;
            flex-wrap: wrap;
        }

        .sidebar {
            display: none;
            width: 250px;
            background-color: #e8e8e8;
            border-right: 1px solid #ccc;
            padding: 0;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background-color: white;
            margin: 20px;
            border: 1px solid #ccc;
        }

        /* Media queries para el dashboard */
        @media (max-width: 768px) {
            .dashboard {
                padding: 1rem;
                margin: 0.5rem;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .sidebar {
                width: 100%;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100%;
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .main-content {
                margin: 0;
                padding: 1rem;
            }
        }

        /* Estilos adicionales que faltaban */
        .btn-logout {
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-logout:hover {
            background: #c82333;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 5px;
        }

        .modal-header {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            font-size: 11px;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
        }

        .hidden {
            display: none;
        }
        .file-input { 
            margin: 20px 0; 
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
            background: #fafafa;
        }
        .file-input:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        .submit-btn:hover {
            background: #0056b3;
        }
        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .message { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 4px; 
            font-weight: 500;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        .file-list {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .file-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-name {
            font-weight: 500;
        }
        .file-info {
            color: #666;
            font-size: 14px;
        }
        .progress {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #007bff;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        .allowed-files {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-size: 14px;
            color: #004085;
        }
        .btn-logout {
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-logout:hover {
            background: #c82333;
        }
        .btn-agregar {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-agregar:hover {
            background: #0056b3;
        }
        .submit-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        .mensajes {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        
        .mensajes.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .mensajes.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login -->
    <div class="login-container" id="loginContainer">
        <div class="logo">SCI</div>
        <h1>Sistema de Control de Inhumaciones</h1>
        
        <form id="loginForm">
            <div class="form-group">
                <label for="usuario">Usuario:</label>
                <input type="text" id="usuario" placeholder="Ingrese su usuario" required>
            </div>
            
            <div class="form-group">
                <label for="contrase침a">Contrase침a:</label>
                <input type="password" id="contrase침a" placeholder="Ingrese su contrase침a" required>
            </div>
            
            <button type="submit" class="btn-login" id="btnLogin">Ingresar</button>
        </form>
        
        <div class="error-message" id="errorMessage"></div>
    </div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>MENU PRINCIPAL</h2>
        </div>
    </div>

    <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <h2>Panel de Control</h2>
            <div class="user-info">
                <span id="userInfo">Bienvenido, Usuario</span>
                <button class="btn-logout" id="logoutBtn">Cerrar Sesi칩n</button>
            </div>
        </div>
        <!-- Secci칩n Generar/Solicitar Licencias -->
        <div id="generar" class="section">
            <form id="inhumacionForm">
            <div class="form-section">
                <div class="form-title">Datos del Fallecido</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>numero de documento:</label>
                        <input type="text" id="numeroDocumento" placeholder="Placeholder">
                    </div>
                    <div class="form-group">
                        <label>Sexo</label>
                        <select id="sexo">
                            <option>M</option>
                            <option>F</option>
                            <option>O</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Primer apellido:</label>
                        <input type="text" id="primerApellido" placeholder="Placeholder">
                    </div>
                    <div class="form-group">
                        <label>Probable manera de muerte</label>
                        <select id="tipoMuerte">
                            <option>Natural</option>
                            <option>Accidental</option>
                            <option>Suicidio</option>
                            <option>Homicidio</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Segundo Apellido</label>
                        <input type="text" id="segundoApellido" placeholder="Placeholder">
                    </div>
                    <div class="form-group">
                        <label>Fecha de fallecimiento</label>
                        <div class="date-picker">
                            <input type="date" id="fechaDefuncion" value="2025-09-09">
                            <div class="calendar tooltip">
                                <div class="tooltip-text">el men칰 fecha se abrir치 cuando se de clic en el campo de fecha de fallecimiento</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Nombres:</label>
                        <input type="text" id="nombres" placeholder="Placeholder">
                    </div>
                    <div class="form-group">
                        <label>N춿 certificado defuncion</label>
                        <input type="text" id="certificadoDefuncion" placeholder="Placeholder">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de documento</label>
                        <select id="tipoDocumento">
                            <option>Cedula</option>
                            <option>Pasaporte</option>
                            <option>Tarjeta de identidad</option>
                            <option>Registro Civil</option>
                            <option>Certificado Nacido Vivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Edad</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="tipoEdad">
                                <option>menor de un dia</option>
                                <option>dias</option>
                                <option>meses</option>
                                <option>a침os</option>
                            </select>
                            <input type="text" id="edad" placeholder="Placeholder" style="width: 100px;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre del solicitante</label>
                        <input type="text" id="nombreSolicitante" placeholder="Placeholder">
                    </div>
                    <div class="form-group">
                        <label id="labelOrigen">Ciudad origen:</label>
                        <input type="text" id="ciudadOrigen" placeholder="Placeholder">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Requiere traslado</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" id="traslado1" name="traslado" value="si" checked>
                                Si
                            </label>
                            <label>
                                <input type="radio" id="traslado2" name="traslado" value="no">
                                No
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label id="labelDestino">Ciudad destino:</label>
                        <input type="text" id="ciudadDestino" placeholder="Placeholder">
                    </div>
                </div>
            </div>
            <input type="hidden" id="idInhuma" value="">
            <div class="buttons" id="buttons">
            </div>
        </div>
        </form>
        <!-- Secci칩n Consultar Licencias -->
        <div id="consultar" class="section hidden">
            <div class="search-bar">
                <label>Ingrese numero de documento del fallecido:</label>
                <input type="text" placeholder="Placeholder" id="searchInput">
                <button class="search-btn" id="searchBtn">游댌</button>
            </div>
            <div id="licenciasList">
                <div class="loading">Cargando registros...</div>
            </div>
        </div>

        <!-- Secci칩n Visualizar Autorizaciones -->
        <div id="visualizar" class="section hidden">
            <div id="inhumacionesList">
                <div class="loading">Cargando registros...</div>
            </div>
        </div>

        <!-- Secci칩n Administraci칩n de Usuarios -->
        <div id="admin" class="section hidden">
            <div class="form-title">Administraci칩n de Usuarios</div>
            <p>Cargando...</p>
        </div>
    </div>

    <!-- Modal para rechazar -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                Inserte las razones de rechazo
            </div>
            <div class="modal-body">
                <textarea id="rejectReason" placeholder="Ingrese las razones aqui" style="width: 100%; height: 100px; margin-top: 10px; padding: 8px; border: 1px solid #ccc;"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="confirmRejectBtn">Confirmar rechazo</button>
                <button class="btn btn-danger" id="cancelRejectBtn">Cancelar rechazo</button>
            </div>
        </div>
    </div>
    <!-- Modal para cargar archivos -->
     <div id="cargarModal" class="modal">
        <div class="modal-content">
            <div class="upload-form">
                <div class="modal-header">Subir Archivos</div>
                <div class="modal-body">
                    <div class="allowed-files">
                        <strong>Tipos de archivo permitidos:</strong> PDF, JPG, JPEG, PNG, GIF<br>
                        <strong>Tama침o m치ximo:</strong> 5MB por archivo | <strong>M치ximo:</strong> 3 archivos
                    </div>

                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="file-input">
                            <label id="fileInput">
                                游늬 Arrastra archivos aqu칤 o haz clic para seleccionar
                            </label><br><br>
                            <input 
                                type="file" 
                                id="archivos"
                                name="documents" 
                                multiple 
                                accept=".pdf,.jpg,.jpeg,.png,.gif"
                                style="margin-top: 10px;"
                            >
                        </div>
                
                        <div id="selectedFiles"></div>
                        
                        <div id="progressContainer" style="display: none;">
                            <div class="progress">
                                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                            </div>
                            <div id="progressText">0%</div>
                        </div>
                    </form>
                </div>
                <div id="message"></div>
            </div>
        </div>
     </div>
     <script src="/js/login.js" defer></script>
     <script>
        // Variables globales
        let authToken = localStorage.getItem('authToken');
        let idReject = localStorage.getItem('idReject')
        handleTableActions();

        // Funciones principales || logeo
        // Event handler centralizado
        function handleTableActions() {
            const checked1 = document.getElementById('traslado1');
            if (checked1) {
                checked1.addEventListener('click', ocultarCampos);
            }

            const checked2 = document.getElementById('traslado2');
            if (checked2) {
                checked2.addEventListener('click', ocultarCampos);
            }

            const btLogout = document.getElementById('logoutBtn');
            if (btLogout) {
                btLogout.addEventListener('click', logout);
            }

            const btCancelReject = document.getElementById('cancelRejectBtn');
            if(btCancelReject){
                btCancelReject.addEventListener('click', closeRejectModal);
            }
            
            const btConfirmReject = document.getElementById('confirmRejectBtn');
            if(btConfirmReject){
                btConfirmReject.addEventListener('click', confirmReject)
            }

            const btSearchBtn = document.getElementById('searchBtn');
            if(btSearchBtn){
                btSearchBtn.addEventListener('click', LoadLicencias);
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            
            // Limpiar formulario de login
            document.getElementById('usuario').value = '';
            document.getElementById('contrase침a').value = '';

            localStorage.removeItem('authToken');
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
            authToken = null;
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function showDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('sidebar').style.display = 'block';
            document.getElementById('dashboard').style.display = 'block';
        }

        function ocultarCampos() {
            const trasladoSi = document.getElementById('traslado1').checked;
            const ciudadOrigen = document.getElementById('ciudadOrigen');
            const ciudadDestino = document.getElementById('ciudadDestino');
            const labelOrigen = document.getElementById('labelOrigen');
            const labelDestino = document.getElementById('labelDestino');
            
            if (trasladoSi) {
                ciudadOrigen.style.display = 'block';
                ciudadDestino.style.display = 'block';
                labelOrigen.style.display = 'block';
                labelDestino.style.display = 'block';
            } else {
                ciudadOrigen.style.display = 'none';
                ciudadDestino.style.display = 'none';
                labelOrigen.style.display = 'none';
                labelDestino.style.display = 'none';
            }
        }

        function showSection(sectionName) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar la secci칩n seleccionada
            const selectedSection = document.getElementById(sectionName);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
            }
            
            // Actualizar men칰 activo
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === sectionName) {
                    item.classList.add('active');
                }
            });
        }
        
        async function LoadLicencias(){
            const searchId = document.getElementById('searchInput').value;
            let authToken = localStorage.getItem('authToken');
            try {
                const response = await fetch(`/api/${searchId}/licencias`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const Licencias = await response.json();
                    displayLicencias(Licencias);
                } else {
                    document.getElementById('licenciasList').innerHTML = '<p>Error al cargar registros</p>';
                }
            } catch (error) {
                document.getElementById('licenciasList').innerHTML = '<p>Error de conexi칩n</p>';
            }
        }
        
        function displayLicencias(licencias) {
            const container = document.getElementById('licenciasList');
            
            if (licencias.length === 0) {
                container.innerHTML = '<p>No hay registros de licencias</p>';
                return;
            }

            const header = `<table class="table">
                <thead>
                    <tr>
                        <th>Numero Documento</th>
                        <th>Nombre</th>
                        <th>estado de la licencia</th>
                        <th>comentarios</th>
                        <th>Opciones</th>
                    </tr>
                </thead>
                <tbody id="licencias-tbody">
                `

            const html = licencias.map(licencia => {
                const autorizado = licencia.autorizado;
                const mostrarDescarga = ['Aprobado'].includes(autorizado);
                const mostrarTramite = ['Rechazado'].includes(autorizado)
                return `
                    <tr>
                        <td>${escapeHtml(licencia.numeroDocumento)}</td>
                        <td>${escapeHtml(licencia.nombres)}  ${escapeHtml(licencia.primerApellido)}  ${escapeHtml(licencia.segundoApellido)}</td>
                        <td>${escapeHtml(licencia.autorizado)}</td>
                        <td>${escapeHtml(licencia.comentarios)}</td>
                        <td>
                            ${mostrarDescarga ? `<a href="#" class="link-btn action-btn" data-action="Visualizar" data-id="${licencia.idLicencia}">Visualizar</a>` : ''}
                            ${mostrarDescarga ? `<a href="#" class="link-btn action-btn" data-action="Descargar" data-id="${licencia.idLicencia}">Descargar</a>` : ''}
                            ${mostrarTramite ? `<a href="#" class="link-btn action-btn" data-action="Tramitar" data-id="${licencia.idLicencia}">Volver a Tramitar</a>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            const footer = `</tbody></table>`

            container.innerHTML = header + html + footer;

            const tableBody = document.getElementById('licencias-tbody');
            if (tableBody) {
                tableBody.innerHTML = html;
                tableBody.addEventListener('click', handleActionClick);
            } else {
                console.error('Elemento tbody con ID "licencias-tbody" no encontrado');
            }
        }

        function buscarLicencias() {
            const searchValue = document.getElementById('searchInput').value;
            
            if (!searchValue) {
                alert('Por favor ingrese un n칰mero de documento para buscar');
                return;
            }
            
            // Aqu칤 ir칤a la l칩gica de b칰squeda
            console.log('Buscando licencias para:', searchValue);
            // Por ahora solo mostraremos un mensaje
            alert(`Buscando licencias para documento: ${searchValue}`);
        }

        function confirmReject() {
            const reason = document.getElementById('rejectReason').value;
            let idReject = localStorage.getItem('idReject');
            
            if (!reason.trim()) {
                alert('Por favor ingrese la raz칩n del rechazo');
                return;
            }
            
            fetch(`/api/inhumaciones/rechazar/${idReject}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                },
                body: JSON.stringify({ motivo: reason.trim() })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Licencia Rechazada exitosamente');
                    // Recargar datos
                    loadInhumaciones();
                } else {
                    alert('Error al rechazar licencia');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error de conexi칩n');
            });
            alert('Licencia rechazada correctamente');
            closeRejectModal();
        }

        function closeRejectModal() {
            document.getElementById('rejectModal').style.display = 'none';
            document.getElementById('rejectReason').value = '';
            idReject = null;
        }

        async function crearUsuario(){
            let authToken = localStorage.getItem('authToken');
            const userData = {
                usuario: document.getElementById('user').value,
                contrase침a: document.getElementById('password').value,
                rol: document.getElementById('rol').value
            };
            try {
                const response = await fetch('/api/crear-usuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}` 
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                const mensajes = document.getElementById('mensajes');
                
                if (response.ok) {
                    mensajes.className = 'mensajes success';
                    mensajes.textContent = 'Usuario creado exitosamente';
                    //this.reset(); // Limpiar formulario
                } else {
                    mensajes.className = 'mensajes error';
                    mensajes.textContent = result.error || 'Error al crear usuario';
                }
                
                // Ocultar mensaje despu칠s de 5 segundos
                setTimeout(() => {
                    mensajes.style.display = 'none';
                }, 5000);
                
            } catch (error) {
                const mensajes = document.getElementById('mensajes');
                mensajes.className = 'mensajes error';
                mensajes.textContent = 'Error de conexi칩n: ' + error.message;
            }
        }
        // Cerrar modales al hacer clic fuera
        window.addEventListener('click', function(event) {
            const rejectModal = document.getElementById('rejectModal');
            const uploadModal = document.getElementById('cargarModal');
            
            if (event.target === rejectModal) {
                closeRejectModal();
            }
            
            if (event.target === uploadModal) {
                uploadModal.style.display = 'none';
            }
        });
    </script>
</body>
</html>